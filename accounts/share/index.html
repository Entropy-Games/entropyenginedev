<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>
        Share Project
    </title>

    <meta name="viewport" content="width=device-width">
    <link rel='stylesheet' href="../../global.css">
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script>
        $(() => {
            $("#header").load("../header.html");
        });
    </script>
</head>
<body>
<div id="header"></div>

<div style="display: flex; align-items: center; justify-content: center">
    <div style="margin-top: 50px; border-radius: 20px; display: inline-block; padding: 10px; border: 1px solid var(--text-colour)" class="blur">
        <div style="text-align: center; margin: 10px 10px 30px 10px;">
            <a class="button" href="../../editor?p=" id="back">back</a>
        </div>
        <div style="text-align: center; margin: 10px">
            <label>
                (Leave blank to allow anyone with the link to access)<Br>
                Username:
                <input type="text" id="username" style="border-bottom: 1px solid var(--text-colour)">
            </label>
        </div>

        <div style="text-align: center; margin: 30px 10px">
            <label for="access">
                Access Level:
            </label>
            <select id="access">
                <option value="0">Can't access</option>
                <option value="1">Edit</option>
            </select>
        </div>


        <div style="text-align: center; margin: 10px">
            <button id="submit" style="font-size: 18px">Share</button>
        </div>

        <div style="text-align: center; min-height: 10px">
            <div id="error" style="color: #fd6262"></div>
        </div>
    </div>
</div>
</body>
</html>

<script type="module">
    import {request} from '../../request.js';
    import {clean, urlParam} from '../../util.js';

    const error = $('#error');
    const projectID = urlParam('p');
    document.getElementById('back').href += projectID;

    const usernameElement = $('#username');
    const accessElement = $('#access');

    $(`#submit`).click(async () => {
        const username = usernameElement.val();
        const accessLevel = accessElement.val();

        if (username) {
			const usernameExists = await request('/username-exists', {
				username: clean(username)
			});
			if (usernameExists.exists !== '1') {
				error.html('That username doesn\'t seem to exist exists');
				return;
			}
        }
        request('/share-project', {
            username,
            accessLevel,
            projectID,
        });
    });

</script>